<!DOCTYPE html>
<html style="font-size: 16px;" lang="en"><head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <meta name="keywords" content="Rent your own bicycle​">
    <meta name="description" content="">
    <title>Add Bike</title>
    <link rel="stylesheet" href="css/nicepage.css" media="screen">
<link rel="stylesheet" href="css/index.css" media="screen">
    <script class="u-script" type="text/javascript" src="css/js/jquery.js" defer=""></script>
    <script class="u-script" type="text/javascript" src="css/js/nicepage.js" defer=""></script>
    <meta name="generator" content="Nicepage 7.0.3, nicepage.com">
    <link id="u-theme-google-font" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,500,500i,700,700i,900,900i|Open+Sans:300,300i,400,400i,500,500i,600,600i,700,700i,800,800i">
    <link id="u-page-google-font" rel="stylesheet" href="https://fonts.googleapis.com/css?family=ADLaM+Display:400">
    
      <style>
        body {
            font-family: Arial, sans-serif;
        }

        form {
            /*max-width: 600px;*/
            width: 1200px;
            margin: auto;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #f9f9f9;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }

        input, textarea, button {
            width: 100%;
            padding: 8px;
            margin-bottom: 16px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        button {
            background-color: #0290e6;
            color: white;
            font-size: 16px;
        }

        button:hover {
            background-color: #0417b2;
        }
    </style>
    
    <style>
    .u-nav {
    display: flex;
    justify-content: center;
    align-items: center;
    list-style: none;
    padding: 0;
    margin: 0;
}
.u-nav-item {
    margin: 0 10px;
}
.u-nav-link {
    text-decoration: none;
    padding: 10px 20px;
    color: black;
}
.u-nav-link:hover {
    color: blue;
}
.hidden {
    display: none;
}
h2.u-text-1 {
    margin-bottom: 0;
}

form#add-bike-form {
    margin-top: 0;
}
.navbar {
    display: flex;
    justify-content: space-between; /* Space between logo and navigation links */
    align-items: center; /* Vertically center the items */
    padding: 10px 20px;
}

/* Adjust the logo if necessary */
.u-logo {
    margin-right: 20px; /* Adjust space between the logo and the nav */
    margin-left: -10px; /* Move the logo slightly to the left */
}
.u-nav {
    display: flex; /* Keep the nav links in a row */
    list-style: none;
    padding: 0;
    margin: 0;
}

/* Ensure the logo image does not collapse */
.u-logo-image {
    max-height: 100px; /* Adjust the height for better scaling */
    max-width: auto; /* Ensure the aspect ratio is maintained */
    object-fit: contain; /* Fit the image within its container */
    margin-top: 45px;
}
/* Style the label */
label {
    font-family: Arial, sans-serif;
    font-size: 16px;
    color: #333;
    margin-bottom: 5px;  /* Space between label and dropdown */
    display: block; /* Ensures the label is displayed above the dropdown */
}

/* Style the dropdown */
#condition {
    font-family: Arial, sans-serif;
    font-size: 14px;
    padding: 10px;
    width: 200px;
    border: 1px solid #ccc;
    border-radius: 5px;
    background-color: #f9f9f9;
    color: #333;
    appearance: none; /* Remove default browser dropdown arrow */
    -webkit-appearance: none; /* Safari */
    -moz-appearance: none; /* Firefox */
    transition: border-color 0.3s ease, background-color 0.3s ease;
}

/* Add a custom arrow icon */
#condition::-ms-expand {
    display: none; /* Hide the default dropdown arrow in Internet Explorer */
}

#condition:focus {
    border-color: #66afe9; /* Blue border when focused */
    background-color: #fff;
    outline: none; /* Remove the default focus outline */
}

/* Hover state */
#condition:hover {
    border-color: #888;
}

/* Add padding and spacing to the form element */
br {
    margin-bottom: 10px;
}

    </style>
    <script type="application/ld+json">{
		"@context": "http://schema.org",
		"@type": "Organization",
		"name": "",
		"logo": "css/images/universite-gustave-eiffel.png"
}</script>
    <meta name="theme-color" content="#478ac9">
    <meta property="og:title" content="Home">
    <meta property="og:type" content="website">
  <meta data-intl-tel-input-cdn-path="intlTelInput/"></head>

<body data-home-page="Home.html" data-home-page-title="Home" data-path-to-root="./" data-include-products="false" class="u-body u-xl-mode" data-lang="en">
  <header class="u-clearfix u-grey-5 u-header u-header" id="sec-4073">
  <div class="u-clearfix u-sheet u-valign-middle-xs u-sheet-1">

<nav class="navbar">
   <a href="#" class="u-image u-logo u-image-1" data-image-width="300" data-image-height="150">
    <img src="css/images/universite-gustave-eiffel.png" class="u-logo-image u-logo-image-1" alt="Université Gustave Eiffel Logo" style="width: auto; height: auto;">
</a>
    <ul class="u-nav u-unstyled u-nav-1">
        <li class="u-nav-item"><a class="u-button-style u-nav-link u-text-active-grey-75 u-text-hover-palette-2-base" href="index.html" style="padding: 10px 20px; margin-left: 80px;">Home</a></li>
        <li class="u-nav-item" id="profile-link" style="display: none;"><a class="u-button-style u-nav-link u-text-active-grey-75 u-text-hover-palette-2-base" href="Sales.html" style="padding: 10px 20px;">Sales</a></li>
        <li class="u-nav-item" id="Bikes-link" style="display: none;"><a class="u-button-style u-nav-link u-text-active-grey-75 u-text-hover-palette-2-base" href="MyBikes.html" style="padding: 10px 20px;">My Bikes</a></li>
        <li class="u-nav-item" id="posts-link" style="display: none;"><a class="u-button-style u-nav-link u-text-active-grey-75 u-text-hover-palette-2-base" href="Annonces.html" style="padding: 10px 20px;">My Posts</a></li>
        <li class="u-nav-item" id="rentals-link" style="display: none;"><a class="u-button-style u-nav-link u-text-active-grey-75 u-text-hover-palette-2-base" href="Page-1.html" style="padding: 10px 20px;">My Rentals</a></li>
        <li class="u-nav-item" id="logout-link" style="display: none;">
           <div style="display: flex; align-items: center; gap: 15px;">
        
        <button id="logout-btn" class="u-border-none u-btn u-btn-round u-button-style u-hover-custom-color-1 u-palette-1-light-1 u-radius u-btn-1">
            Logout
        </button>
        <button id="login-btn" class="u-border-none u-btn u-btn-round u-button-style u-hover-custom-color-1 u-palette-1-light-1 u-radius u-btn-1">
            Login
        </button>
        <h5 id="welcome-message" class="u-text u-text-default u-text-1" style="margin: auto; font-size: 20px;"></h5>
    </div>
    
            <!--  <button id="logout-btn" class="u-border-none u-btn u-btn-round u-button-style u-hover-custom-color-1 u-palette-1-light-1 u-radius u-btn-1">
                Logout
            </button>
        </li>
        <li class="u-nav-item" style="margin-left: 80px;">
        <button id="login-btn" class="u-border-none u-btn u-btn-round u-button-style u-hover-custom-color-1 u-palette-1-light-1 u-radius u-btn-1">
             Login
            </button>
            </li>-->
    </ul>
    <!--<div id="user-info" style="display: none; margin-left: 20px; display: flex; align-items: center;">
    <h5 class="u-text u-text-default u-text-1" id="welcome-message"></h5>
    </div>-->
</nav>

</div></header>
<section class="u-clearfix u-container-align-center-lg u-container-align-center-md u-container-align-center-xl u-container-align-center-xs u-palette-1-light-3 u-section-2" id="carousel_0d8e">
      <h2 class="u-align-center u-custom-font u-text u-text-custom-color-1 u-text-default u-text-1" data-animation-name="customAnimationIn" data-animation-duration="1200" data-animation-delay="0">Add a bike </h2>
      <div class="u-clearfix u-sheet u-sheet-1">
       
        <div class="u-expanded-width u-list u-list-1">
          <div class="u-repeater u-repeater-1">
    
    <form id="add-bike-form" onsubmit="return validateForm(event)">
        <label for="model">Model:</label>
        <input type="text" id="model" name="model" placeholder="Enter bike model" required><br><br>

        <label for="brand">Brand:</label>
        <input type="text" id="brand" name="brand" placeholder="Enter bike brand" required><br><br>

        <label for="condition">Condition:</label>
        <select id="condition" name="condition" required>
            <option value="">Select condition</option>
            <option value="New">New</option>
            <option value="Used">Used</option>
        </select><br><br>

        <label for="color">Color:</label>
        <input type="text" id="color" name="color" placeholder="Enter bike color" required><br><br>

        <label for="image">Upload Image (optional):</label>
        <input type="file" id="image" name="image" accept="image/*"><br><br>

        <button type="submit">Add Bike</button>
    </form>
         </div>
        </div>
      </div>
    </section>
    <script>
        // Validate form inputs
       document.getElementById('add-bike-form').addEventListener('submit', async function (event) {
    event.preventDefault(); // Prevent default form submission

    console.log("Submit button clicked.");
    const userDataJson = sessionStorage.getItem("userData");
    let userData = null;

    try {
        userData = JSON.parse(userDataJson); // Parse user data from session
    } catch (error) {
        console.error("Error parsing user data:", error);
        alert("User is not logged in. Please log in first.");
        return;
    }

    if (!userData || !userData.id) {
        alert("User is not logged in. Please log in first.");
        return;
    }

    const userId = userData.id;

    // Collect form data
    const form = document.getElementById('add-bike-form');
    const formData = new FormData(form);

    // Validate form inputs
    const model = formData.get('model').trim();
    const brand = formData.get('brand').trim();
    const condition = formData.get('condition');
    const color = formData.get('color').trim();
    const imageFile = document.getElementById('image').files[0];

    if (model.length < 3) {
        alert("Model must be at least 3 characters long.");
        return;
    }

    if (brand.length < 3) {
        alert("Brand must be at least 3 characters long.");
        return;
    }

    if (!condition) {
        alert("Please select a condition for the bike.");
        return;
    }

    if (!color.match(/^[a-zA-Z\s]+$/)) {
        alert("Color must only contain letters and spaces.");
        return;
    }

    if (imageFile && imageFile.size > 10 * 1024 * 1024) { // 10MB limit
        alert("Image file size must be less than 10MB.");
        return;
    }

    // Convert image file to Base64 (if uploaded)
    let base64Image = null;
    if (imageFile) {
        base64Image = await convertFileToBase64(imageFile);
    }
    
    // Prepare JSON payload
    const bikeData = {
        model,
        userid: userId, // Associate bike with the current user
        brand,
        condition,
        color,
        images: base64Image ? [base64Image,imageFile.name] : [], // Send Base64 image if available
        rented: false // Default rented status
    };

    console.log("Bike Data to Send:", bikeData);
    
    // Send data to the server
    fetch(`http://localhost:8081/UserWebService/api/bikes?userId=${userId}`, 
    		{
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(bikeData)
    })
        .then(response => {
            if (!response.ok) {
                throw new Error("Failed to register bike.");
            }
            return response.json();
        })
        .then(addedBike => {
    alert("Bike added successfully!");

    // Ensure 'bikes' is initialized and is an array
    if (!Array.isArray(userData.bikes)) {
        userData.bikes = []; // Initialize as an empty array if undefined
    }

    // Add the newly added bike to the current user's bike list
    userData.bikes.push(addedBike);

    // Update session storage for the current user
    sessionStorage.setItem("userData", JSON.stringify(userData));

    form.reset(); // Reset the form
    window.location.href = "MyBikes.html"; // Redirect to MyBikes page
})


        .catch(error => {
            console.error("Error during fetch:", error);
            alert("Error: " + error.message);
        });
});





        // Convert file to Base64
        function convertFileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onloadend = function () {
                    resolve(reader.result);
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }
    </script>
    <script>
   
    document.addEventListener('DOMContentLoaded', () => {
        // Safely retrieve user data from session storage
        const userDataJson = sessionStorage.getItem("userData");
        let userData = null;

        try {
            userData = JSON.parse(userDataJson);
        } catch (error) {
            console.error("Error parsing user data:", error);
        }

        if (userData) {
            console.log("User data found in session:", userData);

            // Safely access and update DOM elements
            const loginBtn = document.getElementById('login-btn');
            const logoutBtn = document.getElementById('logout-link');
            const profileLink = document.getElementById('profile-link');
            const postsLink = document.getElementById('posts-link');
            const bikesLink = document.getElementById('Bikes-link');
            const rentalsLink = document.getElementById('rentals-link');
            const welcomeMessage = document.getElementById('welcome-message');

            if (loginBtn) loginBtn.style.display = 'none';
            if (logoutBtn) logoutBtn.style.display = 'block';
            if (profileLink) profileLink.style.display = 'block';
            if (postsLink) postsLink.style.display = 'block';
            if (bikesLink) bikesLink.style.display = 'block';
            if (rentalsLink) rentalsLink.style.display = 'block';
            if (welcomeMessage) welcomeMessage.textContent = `Welcome, ${userData.first_name}`;
            
            

            
           
            
            
            
        } else {
            console.log("No user data found in session.");
        }

        // Handle login button click
        const loginButton = document.getElementById('login-btn');
        if (loginButton) {
            loginButton.addEventListener('click', () => {
                window.location.href = "Login-Page.html";
            });
        }
        const logoutButton = document.getElementById('logout-btn');
        if (logoutButton) {
            logoutButton.addEventListener('click', () => {
                
                sessionStorage.clear();
                localStorage.clear();   
                
                window.location.href = "Login-Page.html";
            });
        }
    });

</script>
    

   <footer class="u-align-center u-clearfix u-container-align-center u-custom-color-1 u-footer u-footer" id="sec-5467"><div class="u-clearfix u-sheet u-sheet-1">
        <p class="u-small-text u-text u-text-variant u-text-1">© Developed By Eiffel Corp.</p>
      </div></footer>
</body>
</html>
